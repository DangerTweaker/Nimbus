{% extends "bkp/base.html" %}
{% load bkp_extras %}

{% block headtags %}
    <script type="text/javascript" src="{{script_name}}/static/jquery.treeview.js"></script>
    <link type="text/css" rel="stylesheet" href="{{script_name}}/static/jquery.treeview.css"></link>
    
    <script type="text/javascript">
        $(document).ready(
            function() {
                $('.filetree').treeview(
                    {animated: 'fast', collapsed: true}
                );
                
                $('*[rel=tree_select_input]').click(
                    function() {
                        checked = $(this).attr('checked');
                        _id = $(this).attr('id');
                        $('*[rel=' + _id + ']').attr('checked', checked);
                    }
                );
            }
        );
    </script>
{% endblock %}

{% block content %}
    <h1>Backup de {{ comp.computer_name }}</h1>
    <h2>Procedimento: {{ proc.procedure_name }}</h2>
    
    <div class="titulo_botoes">
	    <h3>
	        <span>Arquivos Disponíveis: {{file_count}}</span>
	    </h3>
	    <div class="botao_acoes"></div>
	</div>
	
	<form action="{{ script_name }}/computer/{{ comp.id }}/procedure/{{ proc.id }}/tmp_restore/{{ job_id }}/" method="post">
	<div class="bloco_texto">
		<ul class="filetree">
		{% for dir in file_tree.keys %}
			<li><input type="checkbox" name="dir" rel="tree_select_input" id="tree_select_{{ forloop.counter }}" /> <span class="folder">{{dir}}</span>
			    <ul>
			    {% for file in file_tree|get_value:dir %}
				    <li><input type="checkbox" rel="tree_select_{{ forloop.parentloop.counter }}" name="file_{{ file.0 }}" /> <span class="file">{{ file.1 }}</span></li>
			    {% endfor %}
			    </ul>
			</li>
        {% endfor %}
		</ul>
    </div>
    <button type="submit"><span>Restaurar</span></button>
    </form>





	{% if debug %}
	<div class="bloco_texto">
		{% for file in file_tree %}
			{% if forloop.first %}
		        <table>
		        <thead>
			        <tr>
					<th scope='col'>FJobId</th>
			        <th scope='col'>Tipo</th>
			        <th scope='col'>Caminho</th>
			        <th scope='col'>Arquivo</th>
			        </tr>
		        </thead>
		        <tbody>
			{% endif %}
        <tr> 
			<td>{{ file.FJobId }}</td>
			{% if file.Name %}
	        <td> Arquivo </td>
			{% else %}
	        <td> Diretório </td>
			{% endif %}
	        <td> {{ file.Path }} </td>
	        <td> {{ file.Name }} </td>
		</tr>
			{% if forloop.last %}
		</tbody>
		</table>
			{% endif %}
        {% endfor %}
    </div>
	{% endif %}



<a href="{{script_name}}/computer/{{comp.id}}">Cancelar</a>
<hr />
{% endblock %}
