{% extends "base.html" %}

{% block headtags %}
<script type="text/javascript" src="/media/js/storages.js"></script>
<link rel="stylesheet" type="text/css" href="/media/css/storages.css" />
{% endblock %}

{% block page %}

<div class="block">

	<div class="block_head">
		<div class="bheadl"></div>
		<div class="bheadr"></div>
		<h2>{{title}}</h2>
	</div>

    <div class="block_content">
        <p><a href="/storages/add" class="css3button positive">Adicionar armazenamento</a></p>
        <div class="storages">
        {% for storage in storages %}
            <div class="storage {% if not storage.active %}desativado{% endif %}">
                {% if not storage.active %}<p><strong>Este armazenamento está desativado.</strong></p>{% endif %}
                <div class="left">
                    <div class="title">
                        <img src="/media/icons/storage.png"/>
                        <h3 class="name"><a href="/storages/{{ storage.id }}/view">{{storage.name}}</a></h3>
                        <small class="ip">{{storage.address}}</small>
                    </div>
                    <p class="description">{{storage.description}}</p>
                    <p class="options"><a href="/storages/{{storage.id}}/edit/" class="css3button positive">Editar</a></p>
                    
                </div>
                <div class="right">
                    <div class="floatright">
                        {% if not storage.active %}
                        <form action="/storages/{{storage.id}}/activate/" method="post" class="floatright">
                            <button type="submit" class="css3button positive" value="Ativar">Ativar</button>
                        </form>
                        {% endif %}
                    </div>
                    {% if not storage.profile_set.count %}
                        <div class="message warning">
                            <p>Não existem procedimentos relacionados a este armazenamento.</p>
                        </div>
                    {% else %}
                        <h4>COMPUTADORES RELACIONADOS</h4>
                        
                        <div id="computer-list">
                        {% for computer in storage.get_computers %}
                            <div class="computers">
                                <div class="title">
                                    <a href="#" class="toggle" ref="computer_detail">
                                        <img src="/media/icons/computer.png"/>
                                        <h4>{{computer.name}}</h4>
                                    </a>
                                </div>
                                <div class="computer_detail" class="hidden">
                                    {% for proc in computer.procedure_set.all %}
                                        <h4 class="name">{{proc.name}} <small><a href="{% url nimbus.procedures.views.edit object_id=proc.id %}">(editar)</a></small></h4>
                                        Offsite ativado: {% if proc.offsite_on %}Sim{% else %}Não{% endif %}<br/>
                                        Perfil de configuração: <a href="{% url nimbus.procedures.views.profile_edit object_id=proc.profile.id %}">{{proc.profile.name}}</a><br/>
                                        Agendamento: <a href="{% url nimbus.schedules.views.edit object_id=proc.profile.schedule.id %}">{{proc.profile.schedule}}</a><br/>
                                        Conjunto de arquivos: <a href="{% url nimbus.filesets.views.edit object_id=proc.profile.fileset.id %}">{{proc.profile.fileset}}</a>
                                        <p></p>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="clear"></div>
            </div>
        {% empty %}
            <h2>Não existem armazenamentos ativos.</h2>
            <p>Tente <a href="{% url nimbus.storages.views.add %}">adicionar um armazenamento</a>.</p>
        {% endfor %}
    </div>
        
    </div>
    
    <div class="bendl"></div>
	<div class="bendr"></div>

</div>

{% endblock %}