{% extends "base_wizard.html" %}

{% if page_name == 'timezone' %}
{% block headtags %}
<script type="text/javascript">

    $(document).ready(function() {
        $("select#id_country").bind("change", getAreaChoices);

        $('#offsite_form #id_active').change(function(){
            input_active = $('#offsite_form #id_active');
            ps = input_active.parents().filter('p').siblings().filter(':not(p:last)');
            if (input_active.attr('checked')) {
                ps.slideDown();
            } else {
                ps.slideUp();
            }
        }).change();

        var initial_upload = $("#id_upload_rate").val();
        if(initial_upload == -1) {
            $("#id_upload_rate").hide();
            $("label[for=id_upload_rate]").hide();
            $("#id_active_upload_rate").attr('checked', false).change();
        } else {
            $("#id_active_upload_rate").attr('checked', true).change();
        }

        $("#id_active_upload_rate").change(function(){
            if ($("#id_active_upload_rate").is(':checked')){
                $("#id_upload_rate").show();
                $("label[for=id_upload_rate]").show();
                if (initial_upload == -1)
                    initial_upload = 200;
                $("#id_upload_rate").val(initial_upload);
            } else {
                $("#id_upload_rate").hide();
                $("label[for=id_upload_rate]").hide();
                $("#id_upload_rate").val("-1");
            }
		});
    });

    function getAreaChoices() {
        $.ajax({
            type: "POST",
            url: "{% url nimbus.timezone.views.area_request %}",
            dataType: "json",
            data: {country: $('[name=country]').val()},
            success: function(data, textStatus){
                $("select#id_area").empty();
                $.each(data, function(i, item){
                    $("select#id_area").append(
                        '<option value="'+item+'" selected="selected">'+item+'</option>'
                    );
                });
                $("select#id_area").change();
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert("Status: "+textStatus+".");
                this; // the options for this ajax request
            }
        });
    }

</script>
{% endblock %}
{% endif %}

{% block content %}

    <form action="" method="post" id="{{page_name}}_form">

        {% include "form.html" %}

        <p class="input_submit">
            {% if previous %}
            <a href="{{ previous }}" class="submit left"><span>Anterior</span></a> &nbsp;
            {% endif %}
            <input type="submit" class="submit right no_margin" value="PrÃ³ximo" />
        </p>

        <input type="hidden" name="next" value="{{ next }}" />

    </form>


{% endblock %}
